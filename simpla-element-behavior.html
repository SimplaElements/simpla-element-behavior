<script>"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function changed(e,t,i){e.dispatchEvent(new CustomEvent(t+"-changed",{detail:{value:i}}))}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_get=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},ERRORS={NO_SIMPLA:"Cannot find Simpla, ensure it is included before this component"};window.SimplaElement=function(e){return function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!window.Simpla)throw new Error(NO_SIMPLA);return e._loaded=!1,e.__simplaObservers={},e.__triggerBufferSync=function(){e.loaded&&e._protectedSetCallback()},e}return _inherits(t,e),_createClass(t,[{key:"attributeChangedCallback",value:function(e,t,i){"path"===e?this.path=i:this[e]=null!==i}},{key:"connectedCallback",value:function(){var e=this,i=this.constructor.simplaConfig.events;_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connectedCallback",this)&&_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connectedCallback",this).call(this),i.forEach(function(t){return e.addEventListener(t,e.__triggerBufferSync)}),this.editable=!this.readonly&&(this.editable||Simpla.getState("editable")),this._observeSimplaEditable(),this._initPathIfReady(this.path)}},{key:"disconnectedCallback",value:function(){var e=this,i=this.constructor.simplaConfig.events;_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"disconnectedCallback",this)&&_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"disconnectedCallback",this).call(this),i.forEach(function(t){return e.removeEventListener(t,e.__triggerBufferSync)}),Object.keys(this.__simplaObservers).forEach(function(t){e.__simplaObservers[t].unobserve()}),this.__simplaObservers={}}},{key:"_initPathIfReady",value:function(e){this.isConnected&&void 0!==e&&this._initSimplaPath(e)}},{key:"_initSimplaPath",value:function(e){var t=this;this._loaded=!1,Simpla.get(e).then(function(i){var n=!(i&&i.data),r=t.path!==e,a=Simpla.getState("buffer"),o=a&&a[e]&&!a[e].modified;r||(n&&o?t._protectedSetCallback().then(function(){t._loaded=!0}):(t._protectedGetCallback(i),t._loaded=!0))}),this._observeSimplaBuffer(e)}},{key:"_observeSimplaBuffer",value:function(e){var t=this,i=this.__simplaObservers;e&&(i.buffer&&i.buffer.unobserve(),i.buffer=Simpla.observe(e,function(e){e&&e.data&&t._protectedGetCallback(e)}))}},{key:"updateSimplaBuffer",value:function(){var e=this;return this.constructor.simplaConfig.dataProperties.reduce(function(t,i){return _extends(t,_defineProperty({},i,e[i]))},{})}},{key:"updateFromSimpla",value:function(e){_extends(this,e.data)}},{key:"_protectedGetCallback",value:function(e){this.__loadingFromSimpla=!0,this.updateFromSimpla(e),this.__loadingFromSimpla=!1}},{key:"_protectedSetCallback",value:function(){var e=Promise.resolve();if(!this.__loadingFromSimpla&&this.isConnected&&this.path){var t=this.updateSimplaBuffer(),i=this.constructor.simplaConfig.type;void 0===t&&null!==t||(e=Simpla.set(this.path,{type:i,data:t}))}return e}},{key:"_observeSimplaEditable",value:function(){var e=this,t=this.__simplaObservers;t.editable&&t.editable.unobserve(),t.editable=Simpla.observeState("editable",function(t){e.editable=t})}},{key:"path",get:function(){return this.__path},set:function(e){var t=this.__path;this.__path=e,e!==t&&this._initPathIfReady(e)}},{key:"editable",get:function(){return this.__editable},set:function(e){var t=this.__editable;this.readonly||(this.__editable=e,e!==t&&changed(this,"editable",e))}},{key:"readonly",get:function(){return this.__readonly},set:function(e){var t=this.__readonly;this.__readonly=!1,e||!0!==t?e&&(this.editable=!1):this.editable=Simpla.getState("editable"),this.__readonly=e}},{key:"loaded",get:function(){return this.__loaded}},{key:"_loaded",set:function(e){var t=this.__loaded;this.__loaded=e,e!==t&&changed(this,"loaded",e)}}],[{key:"observedAttributes",get:function(){return["path","editable","readonly","loaded"]}}]),t}(e)}</script> 